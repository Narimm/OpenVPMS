<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Version: 1.0
  ~
  ~ The contents of this file are subject to the OpenVPMS License Version
  ~ 1.0 (the 'License'); you may not use this file except in compliance with
  ~ the License. You may obtain a copy of the License at
  ~ http://www.openvpms.org/license/
  ~
  ~ Software distributed under the License is distributed on an 'AS IS' basis,
  ~ WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
  ~ for the specific language governing rights and limitations under the
  ~ License.
  ~
  ~ Copyright 2015 (C) OpenVPMS Ltd. All Rights Reserved.
  -->

<!-- Created with Jaspersoft Studio version 6.0.4.final using JasperReports Library version 6.0.4  -->
<!-- 2015-06-15T05:45:42 -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
              name="Export Customer Email Addresses for Sales" pageWidth="842" pageHeight="595" orientation="Landscape"
              whenNoDataType="AllSectionsNoDetail" columnWidth="842" leftMargin="0" rightMargin="0" topMargin="0"
              bottomMargin="0" uuid="ca8d8887-bdd7-456c-a56e-f8d80f29fe77">
    <property name="ireport.scriptlethandling" value="0"/>
    <property name="ireport.encoding" value="UTF-8"/>
    <property name="ireport.zoom" value="0.75"/>
    <property name="ireport.x" value="0"/>
    <property name="ireport.y" value="0"/>
    <property name="com.jaspersoft.studio.data.defaultdataadapter" value="OpenVPMS Local"/>
    <import value="net.sf.jasperreports.engine.*"/>
    <import value="java.util.*"/>
    <import value="net.sf.jasperreports.engine.data.*"/>
    <parameter name="Species" class="java.lang.String">
        <parameterDescription><![CDATA[Species selection]]></parameterDescription>
    </parameter>
    <parameter name="Breed" class="java.lang.String">
        <parameterDescription><![CDATA[Breed selection]]></parameterDescription>
    </parameter>
    <parameter name="DOB Start" class="java.util.Date">
        <parameterDescription><![CDATA[Date of Birth from]]></parameterDescription>
        <defaultValueExpression><![CDATA[new Date("01/01/1980")]]></defaultValueExpression>
    </parameter>
    <parameter name="DOB End" class="java.util.Date">
        <parameterDescription><![CDATA[Date of Birth to]]></parameterDescription>
        <defaultValueExpression><![CDATA[new Date()]]></defaultValueExpression>
    </parameter>
    <parameter name="Sale Start" class="java.util.Date">
        <parameterDescription><![CDATA[Sales from]]></parameterDescription>
        <defaultValueExpression><![CDATA[new Date()]]></defaultValueExpression>
    </parameter>
    <parameter name="Sale End" class="java.util.Date">
        <parameterDescription><![CDATA[Sales to]]></parameterDescription>
        <defaultValueExpression><![CDATA[new Date()]]></defaultValueExpression>
    </parameter>
    <parameter name="Product Type" class="java.lang.String">
        <parameterDescription><![CDATA[Product Type selection]]></parameterDescription>
    </parameter>
    <parameter name="Product" class="java.lang.String">
        <parameterDescription><![CDATA[Product Name selection]]></parameterDescription>
    </parameter>
    <parameter name="Classification" class="java.lang.String">
        <parameterDescription><![CDATA[Acct Type or Category]]></parameterDescription>
        <defaultValueExpression><![CDATA[]]></defaultValueExpression>
    </parameter>
    <parameter name="PracticeLocation" class="java.lang.String">
        <parameterDescription><![CDATA[Practice Location]]></parameterDescription>
        <defaultValueExpression><![CDATA[]]></defaultValueExpression>
    </parameter>
    <parameter name="Explain" class="java.lang.Boolean">
        <parameterDescription><![CDATA[Display explanation ?]]></parameterDescription>
        <defaultValueExpression><![CDATA[false]]></defaultValueExpression>
    </parameter>
    <queryString language="SQL">
        <![CDATA[select
  c.entity_id as id,
  c1.value as lastname,
  c2.value as firstname,
  l3.name as title,
  c.description as description,
  ce.name as emailName,
  ced1.value as email, ced2.value as preferred,
  max(pa.activity_start_time) as lastsale,
  if((ced2.value = 'true'), if((lcl.code = 'CORRESPONDENCE'), 30, 10), if((lcl.code = 'CORRESPONDENCE'), 20, 0)) as rank
from
  acts pa
  join act_relationships ar on pa.act_id = ar.source_id
  join acts ca on ar.target_id = ca.act_id and ca.arch_short_name like 'act.customerAccount%Item'
  join participations pp on ca.act_id = pp.act_id
  join entities pr on pr.entity_id = pp.entity_id and pr.arch_short_name like 'product.%'
  left join entity_relationships rp on rp.target_id = pr.entity_id and rp.arch_short_name = 'entityRelationship.productTypeProduct'
  left join entities pt on pt.entity_id = rp.source_id
  join participations pap on ca.act_id = pap.act_id and pap.arch_short_name = 'participation.patient'
  join entities p on p.entity_id = pap.entity_id
  join participations cp on pa.act_id = cp.act_id and cp.arch_short_name = 'participation.customer'
  join entities c on c.entity_id = cp.entity_id
  left join entity_details c1 on c1.entity_id = c.entity_id and c1.name = 'lastName'
  left join entity_details c2 on c2.entity_id = c.entity_id and c2.name = 'firstName'
  left join entity_details c3 on c3.entity_id = c.entity_id and c3.name = 'title'
  left join lookups l3 on l3.code = c3.value and l3.arch_short_name = 'lookup.personTitle'
  
  join contacts ce on ce.party_id = c.entity_id and ce.arch_short_name = "contact.email"
  join contact_details ced1 on ced1.contact_id = ce.contact_id and ced1.name = "emailAddress"
  left join contact_details ced2 on ced2.contact_id = ce.contact_id and ced2.name = "preferred"

  left join contact_classifications ccl ON ccl.contact_id = ce.contact_id
  left join lookups lcl ON lcl.lookup_id = ccl.lookup_id
 
  left join entity_classifications ec on ec.entity_id = c.entity_id
  left join lookups l on l.lookup_id = ec.lookup_id and ((l.arch_short_name = 'lookup.customerAccountType') or (l.arch_short_name = 'lookup.customerType'))
  left join entity_details d1 on d1.entity_id = p.entity_id and d1.name = 'dateOfBirth'
  left join entity_details d2 on d2.entity_id = p.entity_id and d2.name = 'desexed'
  left join entity_details d3 on d3.entity_id = p.entity_id and d3.name = 'deceased'
  left join entity_details d4 on d4.entity_id = p.entity_id and d4.name = 'species'
  left join lookups l4 on l4.code = d4.value and l4.arch_short_name = 'lookup.species'
  left join entity_details d5 on d5.entity_id = p.entity_id and d5.name = 'breed'
  left join lookups l5 on l5.code = d5.value and l5.arch_short_name = 'lookup.breed'
  left join entity_links el on el.source_id = c.entity_id and el.arch_short_name = 'entityLink.customerLocation'
  left join entities loc on loc.entity_id = el.target_id
where
  pa.arch_short_name like 'act.customerAccountCharges%' and
  pa.activity_start_time between $P{Sale Start} and date_add($P{Sale End}, INTERVAL '23:59:59' HOUR_SECOND) and
  pr.name like concat(ifnull($P{Product},""),"%") and
  pt.name like concat(ifnull($P{Product Type},""),"%") and
  p.active = 1 and
  c.active = 1 and
  ifnull(l.name,"-") like concat(ifnull($P{Classification},""),"%") and
  ifnull(loc.name,"-") like concat(ifnull($P{PracticeLocation},""),"%") and
  l4.name like concat(ifnull($P{Species},""),"%") and
  d5.value like concat(ifnull($P{Breed},""),"%") and
  (d1.value between $P{DOB Start} and date_add($P{DOB End}, INTERVAL '23:59:59' HOUR_SECOND) or d1.value is null)
group by c.entity_id, rank
order by c.name, c.entity_id,rank desc, ce.contact_id desc]]>
    </queryString>
    <field name="id" class="java.lang.Long"/>
    <field name="lastname" class="java.lang.String"/>
    <field name="firstname" class="java.lang.String"/>
    <field name="title" class="java.lang.String"/>
    <field name="lastsale" class="java.sql.Timestamp"/>
    <field name="rank" class="java.lang.Integer"/>
    <field name="description" class="java.lang.String">
        <fieldDescription><![CDATA[]]></fieldDescription>
    </field>
    <field name="emailName" class="java.lang.String"/>
    <field name="email" class="java.lang.String"/>
    <field name="preferred" class="java.lang.String"/>
    <variable name="EmailAddr" class="java.lang.String" resetType="Group" resetGroup="id-group" calculation="First">
        <variableExpression><![CDATA[$F{email}]]></variableExpression>
    </variable>
    <variable name="AllEmailAddresses" class="java.lang.String" incrementType="Group" incrementGroup="id-group">
        <variableExpression>
            <![CDATA[$V{id-group_COUNT}==1?$V{AllEmailAddresses}+$V{EmailAddr}+"; ":$V{AllEmailAddresses}]]></variableExpression>
        <initialValueExpression><![CDATA[""]]></initialValueExpression>
    </variable>
    <group name="id-group" minHeightToStartNewPage="18">
        <groupExpression><![CDATA[$F{id}]]></groupExpression>
        <groupHeader>
            <band height="18">
                <textField isStretchWithOverflow="true" isBlankWhenNull="true">
                    <reportElement key="textField" x="0" y="0" width="80" height="13"
                                   uuid="ccd5131d-9550-4efb-81e7-996c7fefa95d"/>
                    <box>
                        <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    </box>
                    <textElement>
                        <font size="8"/>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$F{id}]]></textFieldExpression>
                </textField>
                <textField isStretchWithOverflow="true" isBlankWhenNull="true">
                    <reportElement key="textField" x="80" y="0" width="80" height="13"
                                   uuid="af3aab31-ba9c-4906-ae39-838efa2944d1"/>
                    <box>
                        <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    </box>
                    <textElement>
                        <font size="8"/>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$F{title}]]></textFieldExpression>
                </textField>
                <textField isStretchWithOverflow="true" isBlankWhenNull="true">
                    <reportElement key="textField" x="160" y="0" width="80" height="13"
                                   uuid="16c11acd-fea5-4dea-8b88-9541848d2d1b"/>
                    <box>
                        <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    </box>
                    <textElement>
                        <font size="8"/>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$F{lastname}]]></textFieldExpression>
                </textField>
                <textField isStretchWithOverflow="true" isBlankWhenNull="true">
                    <reportElement key="textField" x="240" y="0" width="80" height="13"
                                   uuid="61029f88-919b-4ec3-bdae-24498f2d8e76"/>
                    <box>
                        <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    </box>
                    <textElement>
                        <font size="8"/>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$F{firstname}]]></textFieldExpression>
                </textField>
                <textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
                    <reportElement key="textField" x="320" y="0" width="160" height="13"
                                   uuid="62806c41-eb86-4aeb-8a58-19cc6b0a6f4c"/>
                    <box>
                        <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    </box>
                    <textElement>
                        <font size="8"/>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$F{description}.replace( '\n', ' ' )]]></textFieldExpression>
                </textField>
                <textField isStretchWithOverflow="true" isBlankWhenNull="true">
                    <reportElement key="textField" x="480" y="0" width="80" height="13"
                                   uuid="a17be48a-b960-4d4a-b6af-951b4e8a3d30"/>
                    <box>
                        <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    </box>
                    <textElement>
                        <font size="8"/>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$F{emailName}]]></textFieldExpression>
                </textField>
                <textField isStretchWithOverflow="true" isBlankWhenNull="true">
                    <reportElement key="textField" x="560" y="0" width="80" height="13"
                                   uuid="77e70472-4e48-4ecc-a575-7105e1bf4446"/>
                    <box>
                        <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    </box>
                    <textElement>
                        <font size="8"/>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$F{email}+";"]]></textFieldExpression>
                </textField>
                <textField isStretchWithOverflow="true" pattern="dd/MM/yyyy" isBlankWhenNull="true">
                    <reportElement key="textField-2" x="640" y="0" width="80" height="13"
                                   uuid="8cfa1b62-b592-4949-a896-9e924650c572"/>
                    <box>
                        <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    </box>
                    <textElement>
                        <font size="8"/>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression>
                        <![CDATA[DateFormat.getDateInstance(DateFormat.SHORT, $P{REPORT_LOCALE}).format($F{lastsale})]]></textFieldExpression>
                </textField>
                <textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
                    <reportElement key="textField-2" x="720" y="0" width="80" height="13"
                                   uuid="dea11cef-0045-45b4-8851-4c7ba6f1c8ba">
                        <property name="local_mesure_unity" value="pixel"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <box>
                        <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    </box>
                    <textElement>
                        <font size="8"/>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$F{rank}]]></textFieldExpression>
                </textField>
            </band>
        </groupHeader>
    </group>
    <background>
        <band splitType="Stretch"/>
    </background>
    <title>
        <band splitType="Stretch"/>
    </title>
    <pageHeader>
        <band splitType="Stretch"/>
    </pageHeader>
    <columnHeader>
        <band height="20" splitType="Stretch">
            <staticText>
                <reportElement key="staticText-1" x="0" y="4" width="80" height="11"
                               uuid="cff93c63-cfc0-42b9-a1da-e24f474262b6"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <font size="8"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[CLIENTID]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-2" x="80" y="4" width="80" height="11"
                               uuid="05603129-970c-458f-bcb0-6a80f8e5d6c6"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <font size="8"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[TITLE]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-3" x="160" y="4" width="80" height="11"
                               uuid="e21c9fcd-a811-4e64-8856-5f6a330b72ad"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <font size="8"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[LASTNAME]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-4" x="240" y="4" width="80" height="11"
                               uuid="accc7096-5c3a-4a4f-97b6-125135c4ebaa"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <font size="8"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[FIRSTNAME]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-5" x="320" y="4" width="160" height="11"
                               uuid="2eaf724b-7b3c-44e0-9932-597495bd9eb0"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <font size="8"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[ADDRESS]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-7" x="480" y="4" width="80" height="11"
                               uuid="740c82b1-2616-42ff-815b-1e9dd9735b0b"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <font size="8"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[EMAIL-NAME]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-8" x="560" y="4" width="80" height="11"
                               uuid="774aa61d-158a-4008-9a4e-e6df19a9fe55"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <font size="8"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[EMAIL-ADDRESS]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-10" x="640" y="4" width="80" height="11"
                               uuid="0e85f657-4118-48df-98b2-bd74ff0d1f2c"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <font size="8"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[LASTSALE]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-10" x="720" y="4" width="80" height="11"
                               uuid="9f7fb141-38d1-4406-9aa9-e4d92d28718e">
                    <property name="local_mesure_unity" value="pixel"/>
                    <property name="com.jaspersoft.studio.unit.y" value="px"/>
                </reportElement>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <font size="8"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[RANK]]></text>
            </staticText>
        </band>
    </columnHeader>
    <columnFooter>
        <band splitType="Stretch"/>
    </columnFooter>
    <pageFooter>
        <band splitType="Stretch"/>
    </pageFooter>
    <summary>
        <band height="594" splitType="Prevent">
            <staticText>
                <reportElement x="0" y="1" width="327" height="20" isRemoveLineWhenBlank="true"
                               uuid="347d9bf5-f8c9-4ce9-8136-8bed52701e0f">
                    <property name="local_mesure_unity" value="pixel"/>
                    <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    <printWhenExpression><![CDATA[new Boolean($V{REPORT_COUNT}.intValue()==0)]]></printWhenExpression>
                </reportElement>
                <textElement textAlignment="Center">
                    <font size="14" isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[No Data Found - Check Parameters]]></text>
            </staticText>
            <staticText>
                <reportElement x="0" y="104" width="840" height="220" isRemoveLineWhenBlank="true"
                               uuid="8603168f-aecb-45a5-89fe-5887a916b007">
                    <property name="local_mesure_unitx" value="pixel"/>
                    <property name="com.jaspersoft.studio.unit.x" value="px"/>
                    <printWhenExpression><![CDATA[$P{Explain}]]></printWhenExpression>
                </reportElement>
                <textElement>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[This report is designed for exporting customer email contact data for use with mail merge facilities.
It finds the customers to whom the specified products were sold in the specified period.
The period is inclusive - ie sales from 00:00 on the start date through 23:59:59 on the end date.
All the text selection fields entered have % added so that leaving them blank will find all, and entering say breed %terrier will find all species containing 'terrier' in their species name, and account type 'c' will include all types starting C. The selection is case-insensitive.
The Patient DOB selection is inclusive (ie from <= DOB<= to), but where Patients have no DOB they will be included.
If there is no Practice Location selection then customers with no Practice Location set will be included. Using the selection '-' will select just those with no Practice Location set. The same applies for the Account Type/Category selection.
Only active customers with active patients are included.
Where the customer has multiple contacts, these are ranked as follows:
  If preferred and purpose Correspondence - score 30; If purpose Correspondence - score 20; If preferred - score 10; else score 0.
The highest rank contact is used, and if more than one has the highest rank, then the newest is used.
Note that prior to using in mail-merge or other programs, you must remove the information and explanation lines following the data lines.
The email addresses have a semi-colon appended so that they can be concatenated.
The cell below this one contains all the addresses concatenated. It is in 1 point font so as to fit in as many as possible. You will not be able to read these in the printed or preview version, but in the exported CSV file they appear correctly. The field can contain over 10,000 email addresses.
See http://chandoo.org/wp/2014/01/13/combine-text-values-quick-tip/ if you need to rebuild this list after removing some data.]]></text>
            </staticText>
            <frame>
                <reportElement x="0" y="20" width="557" height="84" uuid="4f5a3c58-fb51-4570-bcf4-9f1156955f31"/>
                <textField>
                    <reportElement x="79" y="14" width="100" height="14" uuid="22d192a3-6ec5-4b82-a5c7-78aa86edc646">
                        <property name="local_mesure_unitheight" value="pixel"/>
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="local_mesure_unity" value="pixel"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[($P{Species}==null)?"%":$P{Species}+"%"]]></textFieldExpression>
                </textField>
                <textField>
                    <reportElement x="258" y="14" width="100" height="14" uuid="ce939352-3273-4e27-a49a-3ee6a614b59e">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[($P{Breed}==null)?"%":$P{Breed}+"%"]]></textFieldExpression>
                </textField>
                <textField pattern="dd/MM/yyyy">
                    <reportElement x="79" y="28" width="100" height="14" uuid="fed72d31-fde9-48ea-9ed4-e26a492345b2">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="local_mesure_unity" value="pixel"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression>
                        <![CDATA[DateFormat.getDateInstance(DateFormat.SHORT, $P{REPORT_LOCALE}).format($P{DOB Start})]]></textFieldExpression>
                </textField>
                <textField pattern="dd/MM/yyyy">
                    <reportElement x="258" y="28" width="100" height="14" uuid="3a827183-cdef-42e4-aeeb-f101338de6a1">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression>
                        <![CDATA[DateFormat.getDateInstance(DateFormat.SHORT, $P{REPORT_LOCALE}).format($P{DOB End})]]></textFieldExpression>
                </textField>
                <textField pattern="dd/MM/yyyy">
                    <reportElement x="79" y="42" width="100" height="14" uuid="4bc4cf0c-45bd-47c2-8218-bc15069674f7">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="local_mesure_unity" value="pixel"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression>
                        <![CDATA[DateFormat.getDateInstance(DateFormat.SHORT, $P{REPORT_LOCALE}).format($P{Sale Start})]]></textFieldExpression>
                </textField>
                <textField pattern="dd/MM/yyyy">
                    <reportElement x="258" y="42" width="100" height="14" uuid="4eb083d1-7071-4bc4-88b2-199471ca52ba">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression>
                        <![CDATA[DateFormat.getDateInstance(DateFormat.SHORT, $P{REPORT_LOCALE}).format($P{Sale End})]]></textFieldExpression>
                </textField>
                <textField>
                    <reportElement x="79" y="56" width="100" height="14" uuid="4b090adb-4e8a-4ecd-a3a2-b1ae0d5ec592">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="local_mesure_unity" value="pixel"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression>
                        <![CDATA[($P{Product Type}==null)?"%":$P{Product Type}+"%"]]></textFieldExpression>
                </textField>
                <textField>
                    <reportElement x="258" y="56" width="100" height="14" uuid="fe3a089d-d92a-4f60-8d11-c522817e3d01">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[($P{Product}==null)?"%":$P{Product}+"%"]]></textFieldExpression>
                </textField>
                <staticText>
                    <reportElement x="0" y="0" width="79" height="14" uuid="dc535e74-8b66-400f-bd27-0bb2c65c147c">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <text><![CDATA[Parameters]]></text>
                </staticText>
                <staticText>
                    <reportElement x="0" y="14" width="79" height="14" uuid="51366efd-a286-4f6c-8567-6bf2bae11dcf">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <text><![CDATA[Species]]></text>
                </staticText>
                <staticText>
                    <reportElement x="0" y="28" width="79" height="14" uuid="529baa78-3025-4ce1-bae3-5e6ffe6ff83f">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <text><![CDATA[DOB From]]></text>
                </staticText>
                <staticText>
                    <reportElement x="0" y="42" width="79" height="14" uuid="2fefc333-8265-41b4-ab17-97a2ee08b7eb">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <text><![CDATA[Sales From]]></text>
                </staticText>
                <staticText>
                    <reportElement x="0" y="56" width="79" height="14" uuid="ebaf37e8-2339-4130-a1a5-eea1b30364e2">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <text><![CDATA[Product Type]]></text>
                </staticText>
                <staticText>
                    <reportElement x="179" y="14" width="79" height="14" uuid="b8d0558c-392f-421b-ae62-7dee526eb962">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <text><![CDATA[Breed]]></text>
                </staticText>
                <staticText>
                    <reportElement x="179" y="28" width="79" height="14" uuid="c5a68dc4-2bc6-405a-a337-4dfb9b33a5b4">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <text><![CDATA[DOB To]]></text>
                </staticText>
                <staticText>
                    <reportElement x="179" y="42" width="79" height="14" uuid="5f96cdfc-adca-4bae-af06-1022ed471993">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <text><![CDATA[Sales To]]></text>
                </staticText>
                <staticText>
                    <reportElement x="179" y="56" width="79" height="14" uuid="19195b64-cbf6-41ac-9aa8-651519db757c">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <text><![CDATA[Product]]></text>
                </staticText>
                <staticText>
                    <reportElement x="365" y="14" width="55" height="14" uuid="9d648c60-e83f-48b2-b9dc-8e9f07e61935">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <text><![CDATA[Generated]]></text>
                </staticText>
                <textField pattern="dd/MM/yyyy h.mm a">
                    <reportElement x="420" y="14" width="100" height="14" uuid="3f4a53e1-34cf-4527-bad5-9b820d64381c">
                        <property name="local_mesure_unity" value="pixel"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression>
                        <![CDATA[DateFormat.getDateTimeInstance(DateFormat.SHORT,DateFormat.SHORT, $P{REPORT_LOCALE}).format(new Date())]]></textFieldExpression>
                </textField>
                <staticText>
                    <reportElement x="0" y="70" width="79" height="14" uuid="885f32b8-d46f-48c1-a9cc-24e9a65ce508">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <text><![CDATA[Acct.Type/Cat]]></text>
                </staticText>
                <textField>
                    <reportElement x="79" y="70" width="100" height="14" uuid="61775ab0-b6d1-4449-97c3-b0f3778296fd">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="local_mesure_unity" value="pixel"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression>
                        <![CDATA[($P{Classification}==null)?"%":$P{Classification}+"%"]]></textFieldExpression>
                </textField>
                <staticText>
                    <reportElement x="179" y="70" width="79" height="14" uuid="ebd215b0-2adb-4f42-9839-23f5a4607a04">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <text><![CDATA[Practice Locn]]></text>
                </staticText>
                <textField>
                    <reportElement x="258" y="70" width="100" height="14" uuid="a90f1b27-35ac-46ad-aab1-25c112437aa2">
                        <property name="com.jaspersoft.studio.unit.height" value="px"/>
                        <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    </reportElement>
                    <textElement>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression>
                        <![CDATA[($P{PracticeLocation}==null)?"%":$P{PracticeLocation}+"%"]]></textFieldExpression>
                </textField>
            </frame>
            <textField isStretchWithOverflow="true" evaluationTime="Report">
                <reportElement positionType="Float" stretchType="RelativeToBandHeight" x="0" y="324" width="840"
                               height="270" isPrintWhenDetailOverflows="true"
                               uuid="f9639833-c2ef-4422-a591-c6d6d4fae3ca">
                    <property name="local_mesure_unitx" value="pixel"/>
                    <property name="com.jaspersoft.studio.unit.x" value="px"/>
                </reportElement>
                <textElement>
                    <font size="1"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[$V{AllEmailAddresses}]]></textFieldExpression>
            </textField>
        </band>
    </summary>
</jasperReport>
