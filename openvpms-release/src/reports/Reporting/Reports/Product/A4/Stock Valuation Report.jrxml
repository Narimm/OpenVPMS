<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Version: 1.0
  ~
  ~ The contents of this file are subject to the OpenVPMS License Version
  ~ 1.0 (the 'License'); you may not use this file except in compliance with
  ~ the License. You may obtain a copy of the License at
  ~ http://www.openvpms.org/license/
  ~
  ~ Software distributed under the License is distributed on an 'AS IS' basis,
  ~ WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
  ~ for the specific language governing rights and limitations under the
  ~ License.
  ~
  ~ Copyright 2015 (C) OpenVPMS Ltd. All Rights Reserved.
  -->

<!-- Created with Jaspersoft Studio version 6.0.4.final using JasperReports Library version 6.0.4  -->
<!-- 2015-06-15T05:57:14 -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
              name="Stock Valuation Report" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail"
              columnWidth="535" leftMargin="30" rightMargin="30" topMargin="20" bottomMargin="20"
              uuid="f4de84ea-a58e-461d-875b-98506f32bff6">
    <property name="ireport.scriptlethandling" value="0"/>
    <property name="ireport.encoding" value="UTF-8"/>
    <property name="ireport.zoom" value="1.5"/>
    <property name="ireport.x" value="0"/>
    <property name="ireport.y" value="0"/>
    <property name="com.jaspersoft.studio.data.defaultdataadapter" value="OpenVPMS Local"/>
    <import value="net.sf.jasperreports.engine.*"/>
    <import value="java.util.*"/>
    <import value="net.sf.jasperreports.engine.data.*"/>
    <parameter name="IsEmail" class="java.lang.Boolean" isForPrompting="false">
        <parameterDescription>
            <![CDATA[If true, indicates the report is being emailed, to enable different formatting]]></parameterDescription>
        <defaultValueExpression><![CDATA[Boolean.FALSE]]></defaultValueExpression>
    </parameter>
    <parameter name="Stock Location" class="java.lang.String">
        <parameterDescription><![CDATA[Stock Location]]></parameterDescription>
    </parameter>
    <parameter name="Product Type" class="java.lang.String">
        <parameterDescription><![CDATA[Product Type]]></parameterDescription>
    </parameter>
    <parameter name="Classification" class="java.lang.String">
        <parameterDescription><![CDATA[Classification]]></parameterDescription>
    </parameter>
    <parameter name="Product Name" class="java.lang.String">
        <parameterDescription><![CDATA[Product Name]]></parameterDescription>
    </parameter>
    <parameter name="IncMedications" class="java.lang.Boolean">
        <parameterDescription><![CDATA[Include Medication]]></parameterDescription>
        <defaultValueExpression><![CDATA[new Boolean("true")]]></defaultValueExpression>
    </parameter>
    <parameter name="IncMerchandise" class="java.lang.Boolean">
        <parameterDescription><![CDATA[Include Merchandise]]></parameterDescription>
        <defaultValueExpression><![CDATA[new Boolean("true")]]></defaultValueExpression>
    </parameter>
    <parameter name="printDetail" class="java.lang.Boolean">
        <parameterDescription><![CDATA[Show Details]]></parameterDescription>
        <defaultValueExpression><![CDATA[new Boolean("false")]]></defaultValueExpression>
    </parameter>
    <parameter name="Explain" class="java.lang.Boolean">
        <parameterDescription><![CDATA[Display explanation]]></parameterDescription>
        <defaultValueExpression><![CDATA[new Boolean("false")]]></defaultValueExpression>
    </parameter>
    <queryString language="SQL">
        <![CDATA[select  e.entity_id as pid,
	e.name as product, pt.name as ptname,
	l.name as uom,
	sl.name as stockLocation,
	cast(ifnull(d2.value, 0.00) as decimal(18,3)) as currentStock,
	cast(min(ppd.value) as decimal(18,3)) as cost
from entities e
join products p on e.entity_id = p.product_id
join entity_relationships s on s.source_id = e.entity_id
	and s.arch_short_name = "entityRelationship.productStockLocation"
join entity_relationship_details d2 on s.entity_relationship_id = d2.entity_relationship_id
	and d2.name = "quantity"
join entities sl on sl.entity_id = s.target_id
left join entity_relationships r on e.entity_id = r.target_id
	and r.arch_short_name = "entityRelationship.productTypeProduct"
left join entities pt on r.source_id = pt.entity_id
left  join entity_classifications productgroup on productgroup.entity_id = e.entity_id
left  join lookups grouplookup on grouplookup.lookup_id = productgroup.lookup_id
left join entity_details d on d.entity_id = e.entity_id
	and d.name = "sellingUnits"
left join lookups l on l.code = d.value
	and l.arch_short_name = "lookup.uom"
left join entity_relationships lsl on lsl.target_id = sl.entity_id
	and lsl.arch_short_name = "entityRelationship.locationStockLocation"
left join entities pl on pl.entity_id = lsl.source_id
left join entity_classifications plc on pl.entity_id = plc.entity_id
left join lookups locationPricingGroup on plc.lookup_id = locationPricingGroup.lookup_id
	and locationPricingGroup.arch_short_name = "lookup.pricingGroup"
left join product_prices pp on pp.product_id = p.product_id
	and pp.arch_short_name = "productPrice.unitPrice"
left join product_price_classifications ppc on pp.product_price_id = ppc.product_price_id
left join product_price_details ppd on ppd.product_price_id = pp.product_price_id
where e.name like concat(ifnull( $P{Product Name},""),"%")
	and e.active = 1
	and sl.name like concat(ifnull( $P{Stock Location},""),"%")
	and ifnull(grouplookup.name,'-') like concat(ifnull($P{Classification},""),"%")
	and ifnull(pt.name,"-") like concat(ifnull( $P{Product Type},""),"%")
	and ((e.arch_short_name = "product.medication" and $P{IncMedications})
		or (e.arch_short_name = "product.merchandise" and $P{IncMerchandise}))
 	and (locationPricingGroup.lookup_id is null or locationPricingGroup.lookup_id = ppc.lookup_id or not exists (
	        select *
	        from product_price_classifications ppc
	        join lookups l on ppc.lookup_id = l.lookup_id and l.arch_short_name = "lookup.pricingGroup"
	        where ppc.product_price_id = pp.product_price_id))
	and pp.end_time is null
	and ppd.name = "cost"
	and convert(d2.value,decimal(18,3)) > 0.00
group by sl.name, e.name
order by sl.name, e.name, e.entity_id]]>
    </queryString>
    <field name="pid" class="java.lang.Long"/>
    <field name="product" class="java.lang.String"/>
    <field name="uom" class="java.lang.String"/>
    <field name="stockLocation" class="java.lang.String"/>
    <field name="currentStock" class="java.math.BigDecimal"/>
    <field name="cost" class="java.math.BigDecimal"/>
    <field name="ptname" class="java.lang.String"/>
    <variable name="StockValue" class="java.math.BigDecimal" resetType="None">
        <variableExpression><![CDATA[$F{currentStock}.multiply($F{cost})]]></variableExpression>
        <initialValueExpression><![CDATA[new BigDecimal("0.00")]]></initialValueExpression>
    </variable>
    <variable name="TOTAL_STOCKVALUE" class="java.math.BigDecimal" calculation="Sum">
        <variableExpression><![CDATA[$V{StockValue}]]></variableExpression>
        <initialValueExpression><![CDATA[new BigDecimal("0.00")]]></initialValueExpression>
    </variable>
    <variable name="TOTAL_STOCKLOCATION" class="java.math.BigDecimal" resetType="Group" resetGroup="StockLocation"
              calculation="Sum">
        <variableExpression><![CDATA[$V{StockValue}]]></variableExpression>
        <initialValueExpression><![CDATA[new BigDecimal("0.00")]]></initialValueExpression>
    </variable>
    <group name="StockLocation" isReprintHeaderOnEachPage="true">
        <groupExpression><![CDATA[$F{stockLocation}]]></groupExpression>
        <groupHeader>
            <band height="20" splitType="Stretch">
                <textField isBlankWhenNull="true">
                    <reportElement key="textField" x="7" y="0" width="176" height="18"
                                   uuid="5a21bbcb-fb25-4756-9631-df93718668ef">
                        <printWhenExpression><![CDATA[$P{printDetail}.booleanValue()]]></printWhenExpression>
                    </reportElement>
                    <box>
                        <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <bottomPen lineWidth="0.0" lineColor="#000000"/>
                        <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    </box>
                    <textElement>
                        <font size="12" isBold="true"/>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$F{stockLocation}]]></textFieldExpression>
                </textField>
            </band>
        </groupHeader>
        <groupFooter>
            <band height="23" splitType="Stretch">
                <staticText>
                    <reportElement key="staticText-43" x="330" y="3" width="114" height="17"
                                   uuid="797dc972-cc03-4d72-beb2-ca9edeb1413d"/>
                    <box>
                        <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <bottomPen lineWidth="0.0" lineColor="#000000"/>
                        <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    </box>
                    <textElement textAlignment="Right">
                        <font size="12" isBold="true"/>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <text><![CDATA[Location Total: ]]></text>
                </staticText>
                <textField pattern="¤#,##0.00;¤-#,##0.00" isBlankWhenNull="false">
                    <reportElement key="textField" x="445" y="3" width="81" height="17"
                                   uuid="a37c74c3-1684-4615-88a4-d3b5232c9c80"/>
                    <box>
                        <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <bottomPen lineWidth="0.0" lineColor="#000000"/>
                        <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    </box>
                    <textElement textAlignment="Right">
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$V{TOTAL_STOCKLOCATION}]]></textFieldExpression>
                </textField>
                <textField isBlankWhenNull="true">
                    <reportElement key="textField" x="7" y="0" width="176" height="18"
                                   uuid="ed0ac07b-950e-4888-8be7-f2048bc624db">
                        <printWhenExpression>
                            <![CDATA[$P{printDetail}.booleanValue()==Boolean.FALSE]]></printWhenExpression>
                    </reportElement>
                    <box>
                        <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                        <bottomPen lineWidth="0.0" lineColor="#000000"/>
                        <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    </box>
                    <textElement>
                        <font size="12" isBold="true"/>
                        <paragraph lineSpacing="Single"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$F{stockLocation}]]></textFieldExpression>
                </textField>
            </band>
        </groupFooter>
    </group>
    <background>
        <band splitType="Stretch"/>
    </background>
    <title>
        <band splitType="Stretch"/>
    </title>
    <pageHeader>
        <band height="91" splitType="Stretch">
            <staticText>
                <reportElement key="staticText-1" x="120" y="0" width="290" height="24"
                               uuid="aa1c5a4b-a3bb-4eed-8ba3-cbfd5dca182c"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Center">
                    <font size="18" isBold="true" isUnderline="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Stock Valuation]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-35" x="7" y="53" width="83" height="17"
                               uuid="20171097-33f5-44f4-93bd-94b923aa645e"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <font isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Product Name: ]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-36" x="197" y="36" width="83" height="17"
                               uuid="d784dbcf-2f35-427c-9a1e-54a79ea750db">
                    <property name="com.jaspersoft.studio.unit.y" value="px"/>
                </reportElement>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <font isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Product Type: ]]></text>
            </staticText>
            <textField isBlankWhenNull="false">
                <reportElement key="textField" x="90" y="53" width="100" height="17"
                               uuid="7481abb2-fcea-44ec-87df-b8cd92ea0874">
                    <property name="local_mesure_unity" value="pixel"/>
                    <property name="com.jaspersoft.studio.unit.y" value="px"/>
                </reportElement>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[($P{Product Name}==null)?"%":$P{Product Name}+"%"]]></textFieldExpression>
            </textField>
            <textField isBlankWhenNull="false">
                <reportElement key="textField-9" x="280" y="36" width="100" height="17"
                               uuid="46df99fc-3779-44b1-a9b7-fc6068ccb5bc">
                    <property name="com.jaspersoft.studio.unit.y" value="px"/>
                </reportElement>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[($P{Product Type}==null)?"%":$P{Product Type}+"%"]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement key="staticText-41" x="7" y="36" width="83" height="17"
                               uuid="a3b0f272-1dec-4035-ae9d-da5b30ffaeb5">
                    <property name="local_mesure_unitx" value="pixel"/>
                    <property name="com.jaspersoft.studio.unit.x" value="px"/>
                </reportElement>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <font isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Stock Location: ]]></text>
            </staticText>
            <textField isBlankWhenNull="false">
                <reportElement key="textField-10" x="90" y="36" width="100" height="17"
                               uuid="312a6a21-0c2a-4932-841d-4912b8392e88">
                    <property name="local_mesure_unity" value="pixel"/>
                    <property name="com.jaspersoft.studio.unit.y" value="px"/>
                </reportElement>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression>
                    <![CDATA[($P{Stock Location}==null)?"%":$P{Stock Location}+"%"]]></textFieldExpression>
            </textField>
            <textField pattern="dd/MM/yyyy h.mm a">
                <reportElement x="435" y="0" width="100" height="11" uuid="49c082a6-6f0c-42c0-83ac-0e0c9226c127"/>
                <textElement textAlignment="Right">
                    <font size="8"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression>
                    <![CDATA[DateFormat.getDateTimeInstance(DateFormat.SHORT,DateFormat.SHORT, $P{REPORT_LOCALE}).format(new Date())]]></textFieldExpression>
            </textField>
            <textField isBlankWhenNull="false">
                <reportElement key="textField-1" x="428" y="36" width="58" height="17"
                               uuid="28049b67-9dbb-494e-83c9-422667914c17"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA["Page " + $V{PAGE_NUMBER} + " of "]]></textFieldExpression>
            </textField>
            <textField evaluationTime="Report" isBlankWhenNull="false">
                <reportElement key="textField-2" x="490" y="36" width="42" height="17"
                               uuid="ecff863c-9e57-4c6a-8b5d-0da9a2ca81f9"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA["" + $V{PAGE_NUMBER} + ""]]></textFieldExpression>
            </textField>
            <textField pattern="" isBlankWhenNull="false">
                <reportElement key="textField" x="90" y="70" width="221" height="17"
                               uuid="5480a613-14fe-4280-b1c5-69d44265b575">
                    <property name="com.jaspersoft.studio.unit.y" value="px"/>
                </reportElement>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <font fontName="SansSerif"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[" "+($P{IncMedications}.booleanValue()?" Medication":"")
+($P{IncMerchandise}.booleanValue()?" Merchandise":"")]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement key="staticText-10" x="9" y="70" width="81" height="17"
                               uuid="58c8cdbd-6dc9-483a-a912-e0e41bae86f6">
                    <property name="com.jaspersoft.studio.unit.y" value="px"/>
                </reportElement>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <font fontName="SansSerif" isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Includes: ]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-32" x="197" y="53" width="83" height="17"
                               uuid="63cc1ab5-ff02-4490-9101-3fcae634d982">
                    <property name="com.jaspersoft.studio.unit.height" value="px"/>
                    <property name="local_mesure_unity" value="pixel"/>
                    <property name="com.jaspersoft.studio.unit.y" value="px"/>
                    <property name="local_mesure_unitx" value="pixel"/>
                    <property name="com.jaspersoft.studio.unit.x" value="px"/>
                    <property name="local_mesure_unitwidth" value="pixel"/>
                    <property name="com.jaspersoft.studio.unit.width" value="px"/>
                </reportElement>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <font isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Classification: ]]></text>
            </staticText>
            <textField pattern="dd/MM/yyyy" isBlankWhenNull="false">
                <reportElement key="textField-4" x="280" y="53" width="100" height="17"
                               uuid="19d9c5ac-3a5b-4a62-814d-efaeff48c6e9">
                    <property name="com.jaspersoft.studio.unit.height" value="px"/>
                    <property name="com.jaspersoft.studio.unit.y" value="px"/>
                </reportElement>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression>
                    <![CDATA[($P{Classification}==null)?"%":$P{Classification}+"%"]]></textFieldExpression>
            </textField>
        </band>
    </pageHeader>
    <columnHeader>
        <band height="25" splitType="Stretch">
            <printWhenExpression><![CDATA[$P{printDetail}.booleanValue()]]></printWhenExpression>
            <staticText>
                <reportElement key="staticText-11" x="8" y="3" width="52" height="17"
                               uuid="c7d5ea63-394e-4f2c-8ce3-a97af18e0dd9"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <font isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Product]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-14" x="351" y="3" width="54" height="17"
                               uuid="2b5a9c54-0731-4b36-8144-46815719f677"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <font isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Quantity]]></text>
            </staticText>
            <line>
                <reportElement key="line-1" x="5" y="23" width="524" height="1"
                               uuid="49fd1773-a9e1-42bd-b445-25efbe077439"/>
            </line>
            <staticText>
                <reportElement key="staticText-27" x="289" y="3" width="59" height="17"
                               uuid="edbb5a04-1fd5-48f2-a997-68021da72190"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <font isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Units]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-31" x="66" y="3" width="222" height="17"
                               uuid="92cec08f-17f8-4754-a651-12228622f7f7"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Left">
                    <font isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Name]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-34" x="405" y="3" width="56" height="17"
                               uuid="e9068ce8-bb2e-48a9-9389-32730a91c75d"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <font isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Cost]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText-42" x="470" y="3" width="56" height="17"
                               uuid="d61fb21c-5f6b-402a-8f1c-e319176e0012"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <font isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Total]]></text>
            </staticText>
        </band>
    </columnHeader>
    <detail>
        <band height="15" splitType="Stretch">
            <printWhenExpression><![CDATA[$P{printDetail}.booleanValue()]]></printWhenExpression>
            <textField isStretchWithOverflow="true" isBlankWhenNull="true">
                <reportElement key="textField" x="288" y="1" width="60" height="14"
                               uuid="8869b255-23a9-430a-9e00-6437795ac7ca"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{uom}]]></textFieldExpression>
            </textField>
            <textField isStretchWithOverflow="true" pattern="###0" isBlankWhenNull="true">
                <reportElement key="textField-8" x="351" y="1" width="54" height="14"
                               uuid="307a583d-f339-44ba-b801-9b69eabc9732"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{currentStock}]]></textFieldExpression>
            </textField>
            <textField isStretchWithOverflow="true" isBlankWhenNull="true">
                <reportElement key="textField" x="9" y="1" width="51" height="14"
                               uuid="a79244e7-cb18-4574-9d7a-9b9c309f19e0"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{pid}]]></textFieldExpression>
            </textField>
            <textField isStretchWithOverflow="true" isBlankWhenNull="true">
                <reportElement key="textField" x="67" y="1" width="221" height="14"
                               uuid="ca0fb904-c66f-4074-af69-8689b63b411e"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{product}]]></textFieldExpression>
            </textField>
            <textField pattern="##0.00" isBlankWhenNull="false">
                <reportElement key="textField" x="406" y="1" width="54" height="14"
                               uuid="2f16c5d2-0a91-48d4-a201-e7c198a562f5"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{cost}]]></textFieldExpression>
            </textField>
            <textField pattern="##0.00" isBlankWhenNull="false">
                <reportElement key="textField" x="472" y="1" width="54" height="14"
                               uuid="38218cfc-32bb-48da-9e8d-13111dbbecc1"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <font size="10"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[$V{StockValue}]]></textFieldExpression>
            </textField>
        </band>
    </detail>
    <pageFooter>
        <band splitType="Stretch"/>
    </pageFooter>
    <summary>
        <band height="180" splitType="Stretch">
            <staticText>
                <reportElement key="staticText-39" x="7" y="2" width="93" height="17"
                               uuid="7408fab4-4e59-4ad8-8b71-bbba88ea4d09"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <font size="12" isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Product Count: ]]></text>
            </staticText>
            <textField isBlankWhenNull="false">
                <reportElement key="textField" x="110" y="0" width="155" height="17"
                               uuid="59e99c56-2b96-46d3-9d4f-b88ffcec0265"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement>
                    <font size="12"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[$V{REPORT_COUNT}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement key="staticText-44" x="342" y="2" width="103" height="17"
                               uuid="a00173a7-46d8-400c-b657-949835e44b1b"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <font size="12" isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[Grand Total: ]]></text>
            </staticText>
            <textField pattern="¤#,##0.00;¤-#,##0.00" isBlankWhenNull="false">
                <reportElement key="textField-11" x="444" y="2" width="82" height="17"
                               uuid="a01e9606-2ec9-43c2-9ce8-4895f49d2532"/>
                <box>
                    <topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                    <bottomPen lineWidth="0.0" lineColor="#000000"/>
                    <rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
                </box>
                <textElement textAlignment="Right">
                    <font size="12"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[$V{TOTAL_STOCKVALUE}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="120" y="22" width="295" height="20" isRemoveLineWhenBlank="true"
                               uuid="000ae7b6-d70f-43d3-9f55-4542292eb691">
                    <printWhenExpression><![CDATA[new Boolean($V{REPORT_COUNT}.intValue()==0)]]></printWhenExpression>
                </reportElement>
                <textElement textAlignment="Center">
                    <font size="14" isBold="true"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[No Data Found - Check Parameters]]></text>
            </staticText>
            <staticText>
                <reportElement x="1" y="50" width="533" height="130" isRemoveLineWhenBlank="true"
                               uuid="c712ab89-4265-4d48-87ec-ef3408c914c2">
                    <property name="local_mesure_unitx" value="pixel"/>
                    <property name="com.jaspersoft.studio.unit.x" value="px"/>
                    <printWhenExpression><![CDATA[$P{Explain}]]></printWhenExpression>
                </reportElement>
                <textElement>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <text><![CDATA[This report shows the stock valuation for each selected location.
The selection fields entered have % added so that leaving them blank will find all, and entering say product type 'n' will include all product types with names starting 'n' or 'N', and entering product name '%vacc' will find all products with names containing 'vacc'. The selection is case insensitive. 
For Product Type and Classification (Product Group and Product Income Type) selection, omitting the selection will include products with no product type or classification respectively. Using the selection '-' will find only those with no product type or classification.
Only active products are included.
Any negative stock holdings are ignored.
The data is ordered by Stock Location then Product Name.
]]></text>
            </staticText>
        </band>
    </summary>
</jasperReport>
