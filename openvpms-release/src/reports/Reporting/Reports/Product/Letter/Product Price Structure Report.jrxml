<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Product Price Structure report" pageWidth="612" pageHeight="792" whenNoDataType="AllSectionsNoDetail" columnWidth="550" leftMargin="31" rightMargin="31" topMargin="19" bottomMargin="19" isSummaryWithPageHeaderAndFooter="true" uuid="a96e0a17-d397-43e0-937a-92a90c60abbe">
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.encoding" value="UTF-8"/>
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="OpenVPMS Local"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<style name="Base" isDefault="true" hTextAlign="Left" hImageAlign="Left" vTextAlign="Middle" vImageAlign="Middle" fontName="DejaVu Sans" fontSize="9"/>
	<parameter name="IsEmail" class="java.lang.Boolean" isForPrompting="false">
		<parameterDescription><![CDATA[If true, indicates the report is being emailed, to enable different formatting]]></parameterDescription>
		<defaultValueExpression><![CDATA[Boolean.FALSE]]></defaultValueExpression>
	</parameter>
	<parameter name="Product Name" class="java.lang.String">
		<parameterDescription><![CDATA[Product Name]]></parameterDescription>
	</parameter>
	<parameter name="Date" class="java.util.Date">
		<parameterDescription><![CDATA[Price As At Date]]></parameterDescription>
		<defaultValueExpression><![CDATA[new java.util.Date()]]></defaultValueExpression>
	</parameter>
	<parameter name="Product Type" class="java.lang.String">
		<parameterDescription><![CDATA[Product Type]]></parameterDescription>
	</parameter>
	<parameter name="startsBefore" class="java.util.Date">
		<parameterDescription><![CDATA[Price Starts Before]]></parameterDescription>
		<defaultValueExpression><![CDATA[new java.util.Date()]]></defaultValueExpression>
	</parameter>
	<parameter name="Pricing Group" class="java.lang.String">
		<parameterDescription><![CDATA[Pricing Group]]></parameterDescription>
	</parameter>
	<parameter name="LinkedOnly" class="java.lang.Boolean">
		<parameterDescription><![CDATA[Linked Products Only]]></parameterDescription>
		<defaultValueExpression><![CDATA[Boolean.FALSE]]></defaultValueExpression>
	</parameter>
	<parameter name="IncServices" class="java.lang.Boolean">
		<parameterDescription><![CDATA[Include Services]]></parameterDescription>
		<defaultValueExpression><![CDATA[Boolean.TRUE]]></defaultValueExpression>
	</parameter>
	<parameter name="IncMedications" class="java.lang.Boolean">
		<parameterDescription><![CDATA[Include Medications]]></parameterDescription>
		<defaultValueExpression><![CDATA[Boolean.TRUE]]></defaultValueExpression>
	</parameter>
	<parameter name="IncMerchandise" class="java.lang.Boolean">
		<parameterDescription><![CDATA[Include Merchandise]]></parameterDescription>
		<defaultValueExpression><![CDATA[Boolean.TRUE]]></defaultValueExpression>
	</parameter>
	<parameter name="IncTemplates" class="java.lang.Boolean">
		<parameterDescription><![CDATA[Include Price Templates]]></parameterDescription>
		<defaultValueExpression><![CDATA[Boolean.TRUE]]></defaultValueExpression>
	</parameter>
	<parameter name="IncTax" class="java.lang.Boolean">
		<parameterDescription><![CDATA[Include Tax]]></parameterDescription>
		<defaultValueExpression><![CDATA[Boolean.TRUE]]></defaultValueExpression>
	</parameter>
	<parameter name="Explain" class="java.lang.Boolean">
		<parameterDescription><![CDATA[Display explanation]]></parameterDescription>
		<defaultValueExpression><![CDATA[Boolean.FALSE]]></defaultValueExpression>
	</parameter>
	<queryString language="SQL">
		<![CDATA[select  e.name as product,
	e.entity_id as pid,
	e.arch_short_name as archetype,
	pp.price  as price,
	uom.name as uom,
	pp.start_time as priceStartTime,
	pp.end_time as priceEndTime,
	pp.name as priceName,
	pp.ppgName as pricingGroup,
	pp.type as type,
    pp.lkid as lkid
from products p
join entities e on p.product_id = e.entity_id and e.active = 1
left join entity_links r
       on e.entity_id = r.source_id and r.arch_short_name = "entityLink.productType"
left join entities pt
       on r.target_id = pt.entity_id
left join entity_details d1 on d1.entity_id = e.entity_id and d1.name = "sellingUnits"
left join lookups uom on uom.arch_short_name = "lookup.uom" and uom.code = d1.value
left join (
		select pp.price as price, e.entity_id as pid, pp.start_time, pp.end_time, pp.name, ppg.name as ppgName, null as lkid,
			if(pp.arch_short_name="productPrice.fixedPrice","F",if(pp.arch_short_name="productPrice.unitPrice","U","?"))  as type
		from products p
		join entities e on p.product_id = e.entity_id 
		join product_prices pp on e.entity_id = pp.product_id 
			and ((pp.start_time is null or pp.start_time <= $P{Date}) and (pp.end_time is null or pp.end_time > $P{Date}))
		left join product_price_classifications ppc on pp.product_price_id = ppc.product_price_id
		left join lookups ppg on ppc.lookup_id = ppg.lookup_id and ppg.arch_short_name = "lookup.pricingGroup"
		where e.name like concat(ifnull($P{Product Name},""),"%")
	union
		select pp.price as price, e.entity_id as pid, pp.start_time, pp.end_time, pp.name, ppg.name as ppgName, pt.entity_id as lkid,
			if(pp.arch_short_name="productPrice.fixedPrice","LF",if(pp.arch_short_name="productPrice.unitPrice","LU","?"))  as type
		from products p
		join entities e on p.product_id = e.entity_id 
		join entity_relationships erl on erl.source_id = e.entity_id and erl.arch_short_name = 'entityRelationship.productLink'
		join entities pt on pt.entity_id = erl.target_id
		join product_prices pp on pt.entity_id = pp.product_id 
			and ((pp.start_time is null or pp.start_time <= $P{Date}) and (pp.end_time is null or pp.end_time > $P{Date}))
		left join product_price_classifications ppc on pp.product_price_id = ppc.product_price_id
		left join lookups ppg on ppc.lookup_id = ppg.lookup_id and ppg.arch_short_name = "lookup.pricingGroup"
		where e.name like concat(ifnull($P{Product Name},""),"%")
	) as pp on pp.pid = e.entity_id
where e.name like concat(ifnull($P{Product Name},""),"%")
       and ifnull(pt.name,'-') like concat(ifnull( $P{Product Type},""),"%")
       and ifnull(pp.ppgName,'-') like concat(ifnull( $P{Pricing Group},""),"%")
	and ((e.arch_short_name = "product.service" and $P{IncServices})
		or (e.arch_short_name = "product.medication" and $P{IncMedications})
		or (e.arch_short_name = "product.merchandise" and $P{IncMerchandise})
		or (e.arch_short_name = "product.priceTemplate" and $P{IncTemplates}))
	and (pp.start_time <= $P{startsBefore} or pp.start_time is null)
	and ((not  $P{LinkedOnly} ) or ( $P{LinkedOnly} and pp.lkid is not null))
order by product, pricingGroup, pp.type, pp.name, pp.start_time;]]>
	</queryString>
	<field name="product" class="java.lang.String"/>
	<field name="pid" class="java.lang.Long"/>
	<field name="archetype" class="java.lang.String"/>
	<field name="price" class="java.math.BigDecimal"/>
	<field name="uom" class="java.lang.String"/>
	<field name="priceStartTime" class="java.sql.Timestamp"/>
	<field name="priceEndTime" class="java.sql.Timestamp"/>
	<field name="priceName" class="java.lang.String"/>
	<field name="pricingGroup" class="java.lang.String"/>
	<field name="type" class="java.lang.String"/>
	<field name="lkid" class="java.lang.Long"/>
	<variable name="PRICE" class="java.math.BigDecimal">
		<variableExpression><![CDATA[($F{price} != null) ? EVALUATE("product:price($F.pid, $F.price, $P.IncTax)"): new BigDecimal("0.00")]]></variableExpression>
	</variable>
	<variable name="currentPage" class="java.lang.Integer" resetType="Page">
		<variableExpression><![CDATA[$V{PAGE_NUMBER}]]></variableExpression>
		<initialValueExpression><![CDATA[1]]></initialValueExpression>
	</variable>
	<variable name="totalProducts" class="java.lang.Integer" calculation="DistinctCount">
		<variableExpression><![CDATA[$F{pid}]]></variableExpression>
		<initialValueExpression><![CDATA[0]]></initialValueExpression>
	</variable>
	<variable name="TAX_RATE" class="java.math.BigDecimal">
		<variableExpression><![CDATA[EVALUATE("product:taxRate($F.pid)")]]></variableExpression>
	</variable>
	<group name="Product" keepTogether="true">
		<groupExpression><![CDATA[$F{pid}]]></groupExpression>
		<groupHeader>
			<band height="2">
				<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
			</band>
		</groupHeader>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="86" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
			<staticText>
				<reportElement key="staticText-1" x="125" y="0" width="299" height="23" uuid="918b5ceb-1da1-446a-b434-5e701349a59a"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center">
					<font size="16" isBold="true" isUnderline="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Product Price Structure]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-27" x="179" y="35" width="81" height="16" uuid="2d494ac0-5298-4dfd-8d09-a5292e36d286">
					<property name="local_mesure_unity" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Prices As At: ]]></text>
			</staticText>
			<textField pattern="MMMMM dd, yyyy">
				<reportElement x="262" y="35" width="103" height="16" uuid="85f547a8-9288-453a-b0a3-b560eeff3352">
					<property name="local_mesure_unity" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[DateFormat.getDateInstance(DateFormat.SHORT, $P{REPORT_LOCALE}).format($P{Date})]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy h.mm a">
				<reportElement x="447" y="0" width="103" height="10" uuid="48323314-1cce-44c9-952a-f67affd310cf"/>
				<textElement textAlignment="Right">
					<font size="7"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[DateFormat.getDateTimeInstance(DateFormat.SHORT,DateFormat.SHORT, $P{REPORT_LOCALE}).format(new Date())]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-1" x="426" y="17" width="69" height="14" uuid="b7c7c4bf-0697-4516-903f-481b36c6661f">
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Page " + $V{PAGE_NUMBER} + " of "]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report" isBlankWhenNull="false">
				<reportElement key="textField-2" x="499" y="17" width="49" height="14" uuid="965568c1-47b4-46a7-b528-1d00c947ddf8"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["" + $V{PAGE_NUMBER} + ""]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement key="staticText-35" x="0" y="35" width="94" height="16" uuid="7b483fdf-dc6c-4997-96ff-c8c7f70c1532"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Product Name: ]]></text>
			</staticText>
			<textField isBlankWhenNull="false">
				<reportElement key="textField" x="94" y="35" width="71" height="16" uuid="c241cbe8-2f0a-445b-897b-938923d5b0a7"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[($P{Product Name}==null)?"%":$P{Product Name}+"%"]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement key="staticText-36" x="0" y="52" width="94" height="16" uuid="0b831e98-6bdd-4a76-aae3-7b7c98613d17"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Product Type: ]]></text>
			</staticText>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-9" x="94" y="52" width="71" height="16" uuid="57f79c33-f393-4739-9485-e04f2a39f3a6"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[($P{Product Type}==null)?"%":$P{Product Type}+"%"]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement key="staticText-38" x="0" y="69" width="94" height="16" uuid="5719165b-765d-414a-a7cc-172278a734aa"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Pricing Group: ]]></text>
			</staticText>
			<textField>
				<reportElement x="94" y="69" width="71" height="16" uuid="53183b41-5955-4640-9e87-77d602535940"/>
				<textElement>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[($P{Pricing Group}==null)?"%":$P{Pricing Group}+"%"]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement key="staticText-10" x="186" y="52" width="74" height="16" uuid="eaeac190-7f16-4ec6-9dd6-e0cb5ceff8a9"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Includes: ]]></text>
			</staticText>
			<textField pattern="" isBlankWhenNull="false">
				<reportElement key="textField" x="262" y="52" width="285" height="16" uuid="f47d09a1-ae63-469b-b550-9d31b7c0e4db"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[($P{IncServices} ? "Services " : "")
+($P{IncMedications} ? "Medications " : "")
+($P{IncMerchandise} ? "Merchandise " : "")
+($P{IncTemplates} ? "Price Templates " : "")]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement key="staticText-10" x="186" y="69" width="74" height="16" uuid="5426e8f5-bc83-446b-b037-2321b79a6ccf"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Include Tax:]]></text>
			</staticText>
			<textField pattern="" isBlankWhenNull="false">
				<reportElement key="textField" x="262" y="69" width="50" height="16" uuid="0f929f1b-2f6b-45c6-9aa2-a6a01e25e30e"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{IncTax} ? "Yes" : "No"]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement key="staticText-27" x="391" y="35" width="96" height="16" uuid="467db830-ed79-4e7d-b8ab-3362eb44cafe">
					<property name="local_mesure_unity" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Starts Before: ]]></text>
			</staticText>
			<textField pattern="MMMMM dd, yyyy">
				<reportElement x="489" y="35" width="61" height="16" uuid="ff29d867-f426-4369-a366-600cc2c02d12">
					<property name="local_mesure_unity" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
				</reportElement>
				<textElement>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[DateFormat.getDateInstance(DateFormat.SHORT, $P{REPORT_LOCALE}).format($P{startsBefore})]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement key="staticText-10" x="350" y="69" width="134" height="16" uuid="7130c9b9-8ab4-4f31-bc75-5558fdddd33f"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Linked Products only:]]></text>
			</staticText>
			<textField pattern="" isBlankWhenNull="false">
				<reportElement key="textField" x="487" y="69" width="49" height="16" uuid="624dac34-be59-4552-9356-d9befc16c859"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{LinkedOnly} ? "Yes" : "No"]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band height="35" splitType="Stretch">
			<printWhenExpression><![CDATA[$V{PAGE_NUMBER}>1]]></printWhenExpression>
			<textField isBlankWhenNull="false">
				<reportElement key="textField-1" x="426" y="17" width="69" height="14" uuid="033f644c-95f6-4e17-adf9-a9b8027b1e0a">
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Page " + $V{PAGE_NUMBER} + " of "]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report" isBlankWhenNull="false">
				<reportElement key="textField-2" x="499" y="17" width="49" height="14" uuid="29dc15f0-b0f2-4f61-8102-12517709f568"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["" + $V{PAGE_NUMBER} + ""]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy h.mm a">
				<reportElement x="447" y="0" width="103" height="10" uuid="4f47f19f-4801-4142-8d50-006cf8f9dcaa"/>
				<textElement textAlignment="Right">
					<font size="7"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[DateFormat.getDateTimeInstance(DateFormat.SHORT,DateFormat.SHORT, $P{REPORT_LOCALE}).format(new Date())]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement key="staticText-1" x="125" y="0" width="299" height="23" uuid="382e2f2f-af2b-42ec-a2fb-35a3eaf25b04"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center">
					<font size="16" isBold="true" isUnderline="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Product Price Structure]]></text>
			</staticText>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="29" splitType="Stretch">
			<staticText>
				<reportElement key="staticText-11" x="2" y="3" width="215" height="21" uuid="859f4563-75d8-45d4-9957-70702c69f25a">
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font size="7" isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Product]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-13" x="286" y="3" width="26" height="21" uuid="d360e05f-260b-420f-9506-80fb330bfd0b">
					<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center">
					<font size="7" isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Type]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-14" x="379" y="3" width="45" height="21" uuid="b33ba50e-c6d5-4f23-8b2f-c3511bdad7e1"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font size="7" isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Price]]></text>
			</staticText>
			<line>
				<reportElement key="line-1" x="0" y="24" width="550" height="1" uuid="67447730-72bc-496e-93ae-91c2af297317">
					<property name="local_mesure_unity" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
				</reportElement>
			</line>
			<staticText>
				<reportElement key="staticText-27" x="247" y="3" width="39" height="21" uuid="2ae93615-341e-49c3-8c0a-4d3b4e1d461d">
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center">
					<font size="7" isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Units]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-14" x="424" y="3" width="68" height="21" uuid="32ec3ee1-865b-4ec2-8d97-90c6b8137bba"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font size="7" isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Pricing Group
/Link ID]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-14" x="217" y="3" width="30" height="21" uuid="a3d1c0a9-501c-4684-a594-6e37ec46aed4"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font size="7" isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Tax
Rate]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-14" x="492" y="3" width="56" height="21" uuid="bc3ce57b-3d50-4067-a06b-a1d59164aeff">
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font size="7" isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Start]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-13" x="312" y="3" width="67" height="21" uuid="38c81e8f-930e-4c09-8ec1-bc3a919a167b">
					<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left">
					<font size="7" isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[ Name]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="10" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false">
				<reportElement key="textField" isPrintRepeatedValues="false" x="11" y="0" width="206" height="9" printWhenGroupChanges="Product" uuid="33a6a7ed-36f3-48d2-888b-c57b9f98fdc6">
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement verticalAlignment="Top">
					<font size="7"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{product}+" ("+$F{pid}.toString()+")"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement key="textField" isPrintRepeatedValues="false" x="247" y="0" width="39" height="9" printWhenGroupChanges="Product" uuid="f5dc1619-9e78-4e4d-91af-60dbcbc57b8d">
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Top">
					<font size="7"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{uom}]]></textFieldExpression>
			</textField>
			<textField pattern="##0.00" isBlankWhenNull="true">
				<reportElement key="textField" x="286" y="0" width="26" height="9" uuid="2b389ef3-491a-4c30-903b-8909a4cefac0">
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Top">
					<font size="7"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{type}]]></textFieldExpression>
			</textField>
			<textField pattern="##0.00" isBlankWhenNull="true">
				<reportElement key="textField" x="379" y="0" width="45" height="9" uuid="48707657-af4d-4a2e-88c9-f2c5df3cc70e">
					<printWhenExpression><![CDATA[$F{price}!=null]]></printWhenExpression>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Top">
					<font size="7"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{PRICE}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="424" y="0" width="68" height="9" uuid="08a79c22-14cb-46d2-89ae-f2b28917b150"/>
				<textElement textAlignment="Right" verticalAlignment="Top">
					<font size="7"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{lkid}==null?$F{pricingGroup}:$F{lkid}.toString()]]></textFieldExpression>
			</textField>
			<textField pattern="##0.00" isBlankWhenNull="true">
				<reportElement key="textField" isPrintRepeatedValues="false" x="217" y="0" width="30" height="9" printWhenGroupChanges="Product" uuid="74a0f0e1-64e4-4a10-ab1d-596f63b62050"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Top">
					<font size="7"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{TAX_RATE}]]></textFieldExpression>
			</textField>
			<textField pattern="##0.00" isBlankWhenNull="true">
				<reportElement key="textField" x="492" y="0" width="56" height="9" uuid="9eaa119f-3514-4418-9f7c-45d92aaf8b9b">
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Top">
					<font size="7"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[DateFormat.getDateInstance(DateFormat.SHORT, $P{REPORT_LOCALE}).format($F{priceStartTime})]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField" isPrintRepeatedValues="false" x="0" y="0" width="8" height="9" printWhenGroupChanges="Product" uuid="1c0b5a84-a407-47a1-8a8a-259197c3c079">
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement verticalAlignment="Top">
					<font size="7"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{archetype}.compareTo("product.merchandise")==0?"G":
$F{archetype}.compareTo("product.medication")==0?"M":
$F{archetype}.compareTo("product.service")==0?"S":
$F{archetype}.compareTo("product.priceTemplate")==0?"T":"?"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="##0.00" isBlankWhenNull="true">
				<reportElement key="textField" x="312" y="0" width="67" height="9" uuid="1cda7f6f-cef6-43fa-bdd4-6ca71764df71">
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Top">
					<font size="7"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{price}==null?"**NONE**":$F{priceName}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="283" splitType="Stretch">
			<line>
				<reportElement key="line-2" x="0" y="3" width="550" height="1" uuid="321311aa-4cfb-41d9-809a-d9107aa3cb7d">
					<property name="local_mesure_unity" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
				</reportElement>
			</line>
			<staticText>
				<reportElement key="staticText-39" x="2" y="5" width="102" height="16" uuid="02c07ba9-cd5f-4711-a2fd-d566bbf3b83e"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[Product Count:   ]]></text>
			</staticText>
			<textField evaluationTime="Auto" isBlankWhenNull="false">
				<reportElement key="textField" x="104" y="5" width="127" height="16" uuid="de269243-d9f6-41a9-9c9f-99215e562566">
					<property name="local_mesure_unity" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font size="9"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{totalProducts}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="123" y="21" width="304" height="19" isRemoveLineWhenBlank="true" uuid="56810220-1cb6-40a4-b1de-c3bdbe2a2cca">
					<printWhenExpression><![CDATA[new Boolean($V{REPORT_COUNT}.intValue()==0)]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="13" isBold="true"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[No Data Found - Check Parameters]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="40" width="550" height="242" isRemoveLineWhenBlank="true" uuid="44cdce50-af8b-4366-8c58-ed5faf98c61f">
					<printWhenExpression><![CDATA[$P{Explain}]]></printWhenExpression>
				</reportElement>
				<textElement>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<text><![CDATA[This report shows pricing structure of each selected product as at the specified date.
The selection fields entered have % added so that leaving them blank will find all, and entering say product type 'n' will include all product types with names starting 'n' or 'N', and entering product name '%vacc' will find all products with names containing 'vacc'. The selection is case insensitive. For Product Type and Pricing Group selection, omitting the selection will include products with no product type or pricing group respectively, and using the selection '-' will find only those with no product type or pricing group.
The 'Starts Before' date (defaults to today) can be used to select only prices whose start date is prior to this - and thus can be used to find prices that have not been updated for some time.
If 'Linked Products only' is checked then only those selected products linked to a Product Price Template will be displayed and only the linked price(s) will be displayed.
Only active products are included.
The Include Tax parameter determines if prices are displayed including tax.
Although you can select by Product Type, this is not displayed.
The left column indicates the Type of Product (M=Medication, S=Service, G=merchandise ie goods, T=price Template).
The Type column show F for Fixed, U for Unit prices, and LF for Fixed prices from a linked ProductPrice template. In the latter case the ID of the linked template will be shown in the Link ID column.
If the product has no price set then the Type column will be blank and the Name column will show '**NONE**'.
The list is ordered by product name, pricing group, price Type, price Name, price Start Time.]]></text>
			</staticText>
		</band>
	</summary>
</jasperReport>
