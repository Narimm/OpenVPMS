<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE page-specification
      PUBLIC "-//Apache Software Foundation//Tapestry Specification 4.0//EN"
      "http://jakarta.apache.org/tapestry/dtd/Tapestry_4_0.dtd">
<!-- generated by Spindle, http://spindle.sourceforge.net -->

<page-specification class="org.openvpms.component.presentation.tapestry.page.EditPage">
    
    <!-- The Error components for Delegate errors -->
    <property name="currentFieldTracking" />
    <component id="errors" type="For" >
        <binding name="source" value="delegate.fieldTracking" />
        <binding name="value" value="currentFieldTracking" />
    </component>
    <component id="error" type="Delegator" >
        <binding name="delegate" value="currentFieldTracking.errorRenderer" />
    </component>
    <component id="isInError" type="If" >
        <binding name="condition" value="currentFieldTracking.inError" />
        <binding name="element" value="literal:li" />
    </component>   

    <!-- The Submit components for the Main details form -->
    <component id="archetypeCombo" type="PropertySelection">
        <binding name="displayName" value="descriptor.displayName"/>
        <binding name="model" value="getArchetypeNamesModel(descriptor)"/>
        <binding name="value" value="archetypeName" />
    </component>               

    <component id="saveButton" type="Submit">
        <binding name="action" value="listener:onMainApply"/>
    </component>
    <component id="saveAndReturnButton" type="Submit">
        <binding name="action" value="listener:onMainOK"/>
    </component>
     <component id="removeButton" type="Submit">
        <binding name="action" value="listener:onMainRemove"/>
    </component>
     <component id="cancelButton" type="Submit">
        <binding name="action" value="listener:onMainCancel"/>
		<binding name="onclick">
		literal: javascript:this.form.events.cancel();
		</binding>
    </component>
 
    <!-- The Node Form components -->
   	<component id="nodeTable" type="openvpms:NodeTable">
      	<binding name="archetypeDescriptor" value="archetypeDescriptor"/>
        <binding name="model" value="model"/>
        <binding name="nodeNames" value="nodeNames"/>
    </component>

    <component id="nodeForm" type="Form">
        <binding name="delegate" value="bean:delegate" />
        <binding name="listener" value="listener:onMainSubmit" />
        <binding name="refresh" value="listener:onMainRefresh" />
		<binding name="cancel" value="listener:onMainCancel"/>
		<binding name="direct" value="true"/>
    </component>   
    <component id="forEachNode" type="For">
        <binding name="source" value="simpleDescriptors"/>
        <binding name="value" value="descriptor"/>
    </component>
    <component id="hasBlock" type="If">
        <binding name="condition" value="hasBlock(descriptor.name)"/>
    </component>   
    <component id="doesntHaveBlock" type="If">
        <binding name="condition" value="not(hasBlock(descriptor.name))"/>
    </component>      
    <component id="renderBlock" type="RenderBlock">
        <binding name="block" value="getBlock(descriptor.name)"/>
    </component>  
    <component id="isIdentifier" type="If">
        <binding name="condition" value="descriptor.identifier"/>
    </component>
    <component id="isDate" type="If">
        <binding name="condition" value="descriptor.date and !descriptor.identifier" />
    </component> 
    <component id="isString" type="If">
        <binding name="condition" value="descriptor.string and !descriptor.identifier and !descriptor.large and !descriptor.lookup"/>
    </component> 
    <component id="isTextArea" type="If">
        <binding name="condition" value="descriptor.large and descriptor.string and !descriptor.lookup"/>
    </component> 
    <component id="isNumeric" type="If">
        <binding name="condition" value="descriptor.numeric and !descriptor.identifier"/>
    </component> 
    <component id="isBoolean" type="If">
        <binding name="condition" value="descriptor.boolean and !descriptor.identifier"/>
    </component> 
    <component id="isObject" type="If">
        <binding name="condition" value="descriptor.objectReference and !descriptor.collection"/>
    </component>   
    <component id="isCollection" type="If">
        <binding name="condition" value="descriptor.collection"/>
    </component>
    <component id="isLookup" type="If">
        <binding name="condition" value="descriptor.lookup"/>
    </component>
    <component id="notReadOnly" type="If">
        <binding name="condition" value="!descriptor.readOnly"/>
    </component>
    <component id="isReadOnly" type="If">
        <binding name="condition" value="descriptor.readOnly"/>
    </component>
    <component id="notHidden" type="If">
        <binding name="condition" value="!descriptor.hidden"/>
    </component>
    <component id="displayValue" type="Insert">
        <binding name="value" value="jxpath:pathToObject(model, descriptor/path)" />
    </component>
    <component id="dateField" type="DatePicker">
        <binding name="displayName" value="descriptor.displayName"/>
        <binding name="validators" value="getValidators(descriptor)"/>
        <binding name="value" value="jxpath:pathToObject(model, descriptor/path)" />
    </component> 
    <component id="stringField" type="TextField">
        <binding name="displayName" value="descriptor.displayName"/>
        <binding name="validators" value="getValidators(descriptor)"/>
        <binding name="value" value="jxpath:pathToObject(model, descriptor/path)" />
    </component> 
   <component id="textArea" type="TextArea">
        <binding name="value" value="jxpath:pathToObject(model, descriptor/path)" />
    </component> 
    <component id="numberField" type="TextField">
        <binding name="displayName" value="descriptor.displayName"/>
        <binding name="translator" value="translator:number,pattern=#.#"/>
        <binding name="validators" value="getValidators(descriptor)"/>
        <binding name="value" value="jxpath:pathToObject(model, descriptor/path)" />
    </component>   
    <component id="checkbox" type="Checkbox">
        <binding name="value" value="jxpath:pathToObject(model, descriptor/path)" />
    </component>   
    <component id="lookupCombo" type="PropertySelection">
        <binding name="displayName" value="descriptor.displayName"/>
        <binding name="model" value="getLookupModel(descriptor)"/>
        <binding name="value" value="jxpath:pathToObject(model, descriptor/path)" />
        <binding name="onchange" value="literal:this.form.events.refresh()" />        
    </component>       
    <component id="selectObject" type="PropertySelection">
        <binding name="displayName" value="descriptor.displayName"/>
        <binding name="model" value="getEntityModel(descriptor)"/>
        <binding name="value" value="jxpath:pathToObject(model, descriptor/path)" />
    </component>       

    <!-- The Collection details Tab components -->
    
    <component id="tabpanel" type="usc:TabPanel">
    </component>
    <component id="tab" type="usc:Tab">
        <binding name="title" value="descriptor.displayName" />
    </component>
    <component id="forEachCollection" type="Foreach">
        <binding name="source" value="complexDescriptors"/>
        <binding name="value" value="descriptor"/>
    </component>
    <component id="collectionEditor" type="openvpms:CollectionEditor">
        <binding name="collection" value="jxpath:pathToObject(model, descriptor/path)"/>
        <binding name="descriptor" value="descriptor" />
    </component>    
    
	<!--component id="collectionForm" type="Form">
	    <binding name="listener" value="listener:onCollectionFormSubmit"/>
	</component>
    <component id="collectionTable" type="contrib:FormTable">
        <binding name="row" value="currentObject"/>
        <binding name="source" value="jxpath:pathToObject(model, descriptor/path)"/>
        <binding name="columns" value="literal:type,name,description"/>
        <binding name="pageSize" value="10"/>
    </component>	

    <component id="typeColumnValue" type="Block" />
    <component id="nameColumnValue" type="Block" />
    <component id="descriptionColumnValue" type="Block" /-->

    <component id="nameLink" type="LinkSubmit">
        <binding name="listener" value="listener:onCollectionEdit"/>
    </component>
    <component id="insertType" type="Insert">
        <binding name="value" value="jxpath:pathToObject(currentObject,'archetypeId/concept')"/>
    </component>
    <component id="insertName" type="Insert">
        <binding name="value" value="jxpath:pathToObject(currentObject,'name')"/>
    </component>
    <component id="insertDescription" type="Insert">
        <binding name="value" value="jxpath:pathToObject(currentObject,'description')"/>
    </component>
    <component id="addbutton" type="Submit">
        <binding name="listener" value="listener:onCollectionAdd"/>
    </component>
    <component id="removebutton" type="Submit">
        <binding name="listener" value="listener:onCollectionRemove"/>
    </component>  
</page-specification>
