<?xml version="1.0"?>
<!--
  #  Version: 1.0
  #
  #  The contents of this file are subject to the OpenVPMS License Version
  #  1.0 (the 'License'); you may not use this file except in compliance with
  #  the License. You may obtain a copy of the License at
  #  http://www.openvpms.org/license/
  #
  #  Software distributed under the License is distributed on an 'AS IS' basis,
  #  WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
  #  for the specific language governing rights and limitations under the
  #  License.
  #
  #  Copyright 2006 (C) OpenVPMS Ltd. All Rights Reserved.
  #
  #  $Id$
-->
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>

    <query name="act.patientReminder.IN_PROGRESS">
        <![CDATA[
        select distinct act
        from   org.openvpms.component.business.domain.im.act.Act as act,
               org.openvpms.component.business.domain.im.common.Participation as participation,
               org.openvpms.component.business.domain.im.party.Party as patient,
               org.openvpms.component.business.domain.im.party.Party as customer,
               org.openvpms.component.business.domain.im.common.EntityRelationship as relationship
        where  act.archetypeId.concept = 'patientReminder' and
               act.status = 'IN_PROGRESS' and
               act.archetypeId.entityName = 'act' and
               act.archetypeId.rmName = 'common' and
               act.archetypeId.namespace = 'openvpms' and
               act.linkId = participation.act.linkId and
               participation.entity.linkId = patient.linkId and
               participation.archetypeId.concept = 'patient' and
               participation.archetypeId.entityName = 'participation' and
               participation.archetypeId.rmName = 'common' and
               participation.archetypeId.namespace = 'openvpms' and
               patient.linkId = relationship.target.linkId and
               customer.linkId = relationship.source.linkId and
               relationship.archetypeId.concept='patientOwner' and
               relationship.archetypeId.entityName='entityRelationship' and
               relationship.archetypeId.rmName='common' and
               relationship.archetypeId.namespace='openvpms'
        order by customer.name, patient.name
      ]]>
    </query>

    <query name="act.patientReminder.IN_PROGRESS+reminderType">
        <![CDATA[
        select distinct act
        from   org.openvpms.component.business.domain.im.act.Act as act,
               org.openvpms.component.business.domain.im.common.Participation as reminderParticipation,
               org.openvpms.component.business.domain.im.common.Participation as patientParticipation,
               org.openvpms.component.business.domain.im.party.Party as patient,
               org.openvpms.component.business.domain.im.party.Party as customer,
               org.openvpms.component.business.domain.im.common.EntityRelationship as relationship
        where  act.archetypeId.concept = 'patientReminder' and
               act.status = 'IN_PROGRESS' and
               act.archetypeId.entityName = 'act' and
               act.archetypeId.rmName = 'common' and
               act.archetypeId.namespace = 'openvpms' and
               act.linkId = reminderParticipation.act.linkId and
               reminderParticipation.entity.linkId = :linkId and
               reminderParticipation.archetypeId.concept = 'reminderType' and
               reminderParticipation.archetypeId.entityName = 'participation' and
               reminderParticipation.archetypeId.rmName = 'common' and
               reminderParticipation.archetypeId.namespace = 'openvpms' and
               act.linkId = patientParticipation.act.linkId and
               patientParticipation.entity.linkId = patient.linkId and
               patientParticipation.archetypeId.concept = 'patient' and
               patientParticipation.archetypeId.entityName = 'participation' and
               patientParticipation.archetypeId.rmName = 'common' and
               patientParticipation.archetypeId.namespace = 'openvpms' and
               patient.linkId = relationship.target.linkId and
               customer.linkId = relationship.source.linkId and
               relationship.archetypeId.concept='patientOwner' and
               relationship.archetypeId.entityName='entityRelationship' and
               relationship.archetypeId.rmName='common' and
               relationship.archetypeId.namespace='openvpms'
        order by customer.name, patient.name
      ]]>
    </query>

    <query name="act.patientReminder.IN_PROGRESS+dueDateRange">
        <![CDATA[
        select distinct act
        from   org.openvpms.component.business.domain.im.act.Act as act,
               org.openvpms.component.business.domain.im.common.Participation as participation,
               org.openvpms.component.business.domain.im.party.Party as patient,
               org.openvpms.component.business.domain.im.party.Party as customer,
               org.openvpms.component.business.domain.im.common.EntityRelationship as relationship
        where  act.archetypeId.concept = 'patientReminder' and
               act.status = 'IN_PROGRESS' and
               act.archetypeId.entityName = 'act' and
               act.archetypeId.rmName = 'common' and
               act.archetypeId.namespace = 'openvpms' and
               act.activityEndTime between :dueFrom and :dueTo and
               act.linkId = participation.act.linkId and
               participation.entity.linkId = patient.linkId and
               participation.archetypeId.concept = 'patient' and
               participation.archetypeId.entityName = 'participation' and
               participation.archetypeId.rmName = 'common' and
               participation.archetypeId.namespace = 'openvpms' and
               patient.linkId = relationship.target.linkId and
               customer.linkId = relationship.source.linkId and
               relationship.archetypeId.concept='patientOwner' and
               relationship.archetypeId.entityName='entityRelationship' and
               relationship.archetypeId.rmName='common' and
               relationship.archetypeId.namespace='openvpms'
        order by customer.name, patient.name
      ]]>
    </query>

    <query name="act.patientReminder.IN_PROGRESS+customerRange">
        <![CDATA[
        select distinct act
        from   org.openvpms.component.business.domain.im.act.Act as act,
               org.openvpms.component.business.domain.im.common.Participation as participation,
               org.openvpms.component.business.domain.im.party.Party as patient,
               org.openvpms.component.business.domain.im.party.Party as customer,
               org.openvpms.component.business.domain.im.common.EntityRelationship as relationship
        where  act.archetypeId.concept = 'patientReminder' and
               act.status = 'IN_PROGRESS' and
               act.archetypeId.entityName = 'act' and
               act.archetypeId.rmName = 'common' and
               act.archetypeId.namespace = 'openvpms' and
               customer.name between :nameFrom and :nameTo and
               act.linkId = participation.act.linkId and
               participation.entity.linkId = patient.linkId and
               participation.archetypeId.concept = 'patient' and
               participation.archetypeId.entityName = 'participation' and
               participation.archetypeId.rmName = 'common' and
               participation.archetypeId.namespace = 'openvpms' and
               patient.linkId = relationship.target.linkId and
               customer.linkId = relationship.source.linkId and
               relationship.archetypeId.concept='patientOwner' and
               relationship.archetypeId.entityName='entityRelationship' and
               relationship.archetypeId.rmName='common' and
               relationship.archetypeId.namespace='openvpms'
        order by customer.name, patient.name
       ]]>
    </query>

    <query name="act.patientReminder.IN_PROGRESS+reminderType+dueDateRange">
        <![CDATA[
        select distinct act
        from   org.openvpms.component.business.domain.im.act.Act as act,
               org.openvpms.component.business.domain.im.common.Participation as reminderParticipation,
               org.openvpms.component.business.domain.im.common.Participation as patientParticipation,
               org.openvpms.component.business.domain.im.party.Party as patient,
               org.openvpms.component.business.domain.im.party.Party as customer,
               org.openvpms.component.business.domain.im.common.EntityRelationship as relationship
        where  act.archetypeId.concept = 'patientReminder' and
               act.status = 'IN_PROGRESS' and
               act.archetypeId.entityName = 'act' and
               act.archetypeId.rmName = 'common' and
               act.archetypeId.namespace = 'openvpms' and
               act.activityEndTime between :dueFrom and :dueTo and
               act.linkId = reminderParticipation.act.linkId and
               reminderParticipation.entity.linkId = :linkId and
               reminderParticipation.archetypeId.concept = 'reminderType' and
               reminderParticipation.archetypeId.entityName = 'participation' and
               reminderParticipation.archetypeId.rmName = 'common' and
               reminderParticipation.archetypeId.namespace = 'openvpms' and
               act.linkId = patientParticipation.act.linkId and
               patientParticipation.entity.linkId = patient.linkId and
               patientParticipation.archetypeId.concept = 'patient' and
               patientParticipation.archetypeId.entityName = 'participation' and
               patientParticipation.archetypeId.rmName = 'common' and
               patientParticipation.archetypeId.namespace = 'openvpms' and
               patient.linkId = relationship.target.linkId and
               customer.linkId = relationship.source.linkId and
               relationship.archetypeId.concept='patientOwner' and
               relationship.archetypeId.entityName='entityRelationship' and
               relationship.archetypeId.rmName='common' and
               relationship.archetypeId.namespace='openvpms'
        order by customer.name, patient.name
       ]]>
    </query>

    <query name="act.patientReminder.IN_PROGRESS+reminderType+customerRange">
        <![CDATA[
        select distinct act
        from   org.openvpms.component.business.domain.im.act.Act as act,
               org.openvpms.component.business.domain.im.common.Participation as reminderParticipation,
               org.openvpms.component.business.domain.im.common.Participation as patientParticipation,
               org.openvpms.component.business.domain.im.party.Party as patient,
               org.openvpms.component.business.domain.im.party.Party as customer,
               org.openvpms.component.business.domain.im.common.EntityRelationship as relationship
        where  act.archetypeId.concept = 'patientReminder' and
               act.status = 'IN_PROGRESS' and
               act.archetypeId.entityName = 'act' and
               act.archetypeId.rmName = 'common' and
               act.archetypeId.namespace = 'openvpms' and
               act.linkId = reminderParticipation.act.linkId and
               reminderParticipation.entity.linkId = :linkId and
               reminderParticipation.archetypeId.concept = 'reminderType' and
               reminderParticipation.archetypeId.entityName = 'participation' and
               reminderParticipation.archetypeId.rmName = 'common' and
               reminderParticipation.archetypeId.namespace = 'openvpms' and
               customer.name between :nameFrom and :nameTo and
               act.linkId = patientParticipation.act.linkId and
               patientParticipation.entity.linkId = patient.linkId and
               patientParticipation.archetypeId.concept = 'patient' and
               patientParticipation.archetypeId.entityName = 'participation' and
               patientParticipation.archetypeId.rmName = 'common' and
               patientParticipation.archetypeId.namespace = 'openvpms' and
               patient.linkId = relationship.target.linkId and
               customer.linkId = relationship.source.linkId and
               relationship.archetypeId.concept='patientOwner' and
               relationship.archetypeId.entityName='entityRelationship' and
               relationship.archetypeId.rmName='common' and
               relationship.archetypeId.namespace='openvpms'
        order by customer.name, patient.name
      ]]>
    </query>

    <query name="act.patientReminder.IN_PROGRESS+dueDateRange+customerRange">
        <![CDATA[
        select distinct act
        from   org.openvpms.component.business.domain.im.act.Act as act,
               org.openvpms.component.business.domain.im.common.Participation as patientParticipation,
               org.openvpms.component.business.domain.im.party.Party as patient,
               org.openvpms.component.business.domain.im.party.Party as customer,
               org.openvpms.component.business.domain.im.common.EntityRelationship as relationship
        where  act.archetypeId.concept = 'patientReminder' and
               act.status = 'IN_PROGRESS' and
               act.archetypeId.entityName = 'act' and
               act.archetypeId.rmName = 'common' and
               act.archetypeId.namespace = 'openvpms' and
               act.activityEndTime between :dueFrom and :dueTo and
               customer.name between :nameFrom and :nameTo and
               act.linkId = patientParticipation.act.linkId and
               patientParticipation.entity.linkId = patient.linkId and
               patientParticipation.archetypeId.concept = 'patient' and
               patientParticipation.archetypeId.entityName = 'participation' and
               patientParticipation.archetypeId.rmName = 'common' and
               patientParticipation.archetypeId.namespace = 'openvpms' and
               patient.linkId = relationship.target.linkId and
               customer.linkId = relationship.source.linkId and
               relationship.archetypeId.concept='patientOwner' and
               relationship.archetypeId.entityName='entityRelationship' and
               relationship.archetypeId.rmName='common' and
               relationship.archetypeId.namespace='openvpms'
        order by customer.name, patient.name
      ]]>
    </query>

    <query name="act.patientReminder.IN_PROGRESS+reminderType+dueDateRange+customerRange">
        <![CDATA[
        select distinct act
        from   org.openvpms.component.business.domain.im.act.Act as act,
               org.openvpms.component.business.domain.im.common.Participation as reminderParticipation,
               org.openvpms.component.business.domain.im.common.Participation as patientParticipation,
               org.openvpms.component.business.domain.im.party.Party as patient,
               org.openvpms.component.business.domain.im.party.Party as customer,
               org.openvpms.component.business.domain.im.common.EntityRelationship as relationship
        where  act.archetypeId.concept = 'patientReminder' and
               act.status = 'IN_PROGRESS' and
               act.archetypeId.entityName = 'act' and
               act.archetypeId.rmName = 'common' and
               act.archetypeId.namespace = 'openvpms' and
               act.activityEndTime between :dueFrom and :dueTo and
               act.linkId = reminderParticipation.act.linkId and
               reminderParticipation.entity.linkId = :linkId and
               reminderParticipation.archetypeId.concept = 'reminderType' and
               reminderParticipation.archetypeId.entityName = 'participation' and
               reminderParticipation.archetypeId.rmName = 'common' and
               reminderParticipation.archetypeId.namespace = 'openvpms' and
               customer.name between :nameFrom and :nameTo and
               act.linkId = patientParticipation.act.linkId and
               patientParticipation.entity.linkId = patient.linkId and
               patientParticipation.archetypeId.concept = 'patient' and
               patientParticipation.archetypeId.entityName = 'participation' and
               patientParticipation.archetypeId.rmName = 'common' and
               patientParticipation.archetypeId.namespace = 'openvpms' and
               patient.linkId = relationship.target.linkId and
               customer.linkId = relationship.source.linkId and
               relationship.archetypeId.concept='patientOwner' and
               relationship.archetypeId.entityName='entityRelationship' and
               relationship.archetypeId.rmName='common' and
               relationship.archetypeId.namespace='openvpms'
        order by customer.name, patient.name
       ]]>
    </query>

</hibernate-mapping>